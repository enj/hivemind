
https://www.broadinstitute.org/gatk/guide/presentations?id=4765
https://www.broadinstitute.org/gatk/guide/tagged?tag=intervals


#Reference File
fasta=/data/Annotation/GATK/hg19/ucsc.hg19.fasta
knownvcf=/data/Annotation/GATK/hg19/NA12878.HiSeq.WGS.bwa.cleaned.raw.subset.hg19.sites.vcf
knownindel=/data/Annotation/GATK/hg19/Mills_and_1000G_gold_standard.indels.hg19.sites.vcf
capture=/data/Annotation/GATK/Agilent/SureSelectExonV5+UTRs/S04380219_Covered.bed

# Programs
bwa=/opt/NGS/bwa-0.7.12/bwa
sortsam=/opt/NGS/picard-tools-1.119/SortSam.jar
markdup=/opt/NGS/picard-tools-1.119/MarkDuplicates.jar
buildbamindex=/opt/NGS/picard-tools-1.119/BuildBamIndex.jar
gatk=/opt/NGS/GATK/GenomeAnalysisTK.jar

bwacore=10

# Lane
f1=/ssddata/Patz/Reads/Sample_CF33C/CF33C_CGATGT_L001_R1_001.fastq.gz
f2=/ssddata/Patz/Reads/Sample_CF33C/CF33C_CGATGT_L001_R2_001.fastq.gz
rg="@RG\tID:CF33C.L001\tSM:CF33C\tPL:ILLUMINA"


samfile=CF33C_CGATGT_L001.sam
bamfilesort=CF33C_CGATGT_L001-sort.bam
bamfilesortdup=CF33C_CGATGT_L001-sort-dup.bam
metricfile=CF33C_CGATGT_L001-dup-metrics.txt
bamfilerealigned=CF33C_CGATGT_L001-sort-dup-realign.bam
recaltable=CF33C_CGATGT_L001-recal-table.txt
realignint=CF33C_CGATGT_L001-realign.txt

STEP 1 (Align Lane)
# align samples
bwa mem -aM -t $bwacore -R $rg $fasta $f1 $f2 > $samfile

STEP 2 (Sort Lane)
java -jar $sortsam I=$samfile  O=$bamfilesort  SO=coordinate 

STEP 3 (Mark Duplicates)

java -jar $markdup I=$bamfilesort O=$bamfilesortdup M=$metricfile 

STEP 4 (Index BAM file)
java -jar $buildbamindex INPUT=$bamfilesortdup

STEP 5 (Local Realignment)

java -jar $gatk -T RealignerTargetCreator -R $fasta -I $bamfilesortdup -known $knownindel -targetIntervals $realignint 
https://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_gatk_tools_walkers_indels_IndelRealigner.php
java -jar $gatk -T IndelRealigner -R $fasta -I $bamfilesortdup -known $knownindel -targetIntervals $realignint  -o $bamfilerealigned --filter_bases_not_stored 


STEP 6 (Base Recalibration)
https://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_gatk_tools_walkers_bqsr_BaseRecalibrator.php
java -jar $gatk  -T BaseRecalibrator -R $fasta -I $bamfilerealigned -knownSites $knownvcf -knownSites $knownindel -L $capture -o $recaltable


# Now you have the bam file for lane 001. Repeat these steps to get bam files for lanes 002, 003, and 004 and then merge them

https://www.broadinstitute.org/gatk/gatkdocs/org_broadinstitute_gatk_tools_walkers_readutils_PrintReads.php
java -jar gatk -T PrintReads  -R fasta  -o output.bam -I L002.bam -I L002.bam -I L003.bam -I L004.bam --read_filter MappingQualityZero

# Next repeat steps 3,4, 5 and 6 on output.bam
